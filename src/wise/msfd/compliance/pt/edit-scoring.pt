<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  lang="en"
  metal:use-macro="context/main_template/macros/master"
  i18n:domain="eea">

  <body metal:fill-slot="content">

    <div id="layout-contents" tal:define="text context/text | nothing" >
      <div id="wise-search-form" class="full-width-marker">
        <div id="wise-search-form-top">
          <metal:tabs metal:use-macro="context/wise-macros/macros/tabs"></metal:tabs>
        </div>

        <div class="start-page-content left-side-form"
          tal:define="descriptors python: view.get_descriptors">

          <h1>Edit scoring</h1>

          <div class="nda-link">
            <a href="./">
              <i class='fa fa-level-up'></i>
              Go to the Compliance Assessment Module
            </a>
          </div>

          <div role="alert"
               tal:attributes="class string:alert alert-${options/level}"
               tal:condition="options/message">
            <strong tal:content="options/message">Message</strong>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>


          <h3 style="display: inline;">Question weights per descriptor</h3>
          <button class="btn btn-primary btn-xs btn-light"
            data-toggle="modal" data-target="#edit-weights">Edit</button>

          <table class="table as-table-overview table-striped"
            tal:repeat="art python: view.questions.items()">
            <thead>
              <tr>
                <th tal:content="python: art[0]">Artx</th>
                <th tal:repeat="desc descriptors"
                    tal:content="python: desc[0]">Descriptor</th>
              </tr>
            </thead>
            <tbody>
              <tr tal:repeat="question python:art[1]">
                <th>
                  <span tal:content="python: question.id">D0</span>
                </th>

                <td tal:repeat="desc descriptors"
                  tal:content="python: view.get_weight_from_annot(question.id, desc[0])">
                  <!--tal:content="python: question.score_weights.get(desc[0], '-')">-->

                </td>
              </tr>
            </tbody>
          </table>

          <form method="Post">
            <input type="submit" class="btn btn-primary btn-small btn-success"
                   value="Recalculate scores"
                   name="recalculate-scores"/>
            <input style="padding-right:32px;"
                type="submit" class="btn btn-primary btn-small btn-danger"
                   value="Reset assessments"
                   name="reset-assessments"/>
            <i style="position: relative; left: -28px; top: 1px;"
                class="fa fa-exclamation-triangle" aria-hidden="true"></i>
            <input type="submit" class="btn btn-primary btn-small btn-warning"
                   value="Reset weights"
                   name="clear-annot"/>
          </form>

          <div id="edit-weights" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h3 class="modal-title">Edit weights</h3>
                </div>
                <div class="modal-body">
                  <form method="POST" name="weights-form">
                    <div>
                      <textarea style="height: 75rem;"
                        tal:attributes="id string:weights; name string:weights"
                        tal:content="view/list_questions">A09Ad1, D5, 6</textarea>
                    </div>
                    <div>
                      <input type="submit" class="btn btn-primary" value="Save">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
