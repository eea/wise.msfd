!function(m){function h(){var t="s--Plone"+window.location.pathname.split("/").slice(0,-1).join("-");document.cookie=t+"="+Date.now()+";path=/"}function f(){colorPalette={light:["lightgreen","lightblue","lightgoldenrodyellow","lightgrey"],dark:["darkgreen","darkblue","darkmagenta","darkred"]},usernames={light:[],dark:[]},m(".comment-name").each(function(){var t=m(this).attr("group-id"),e=m(this).text();-1===usernames[t].indexOf(e)&&usernames[t].push(e)}),m(".comms").each(function(){var t=m(this).find(".comment-name"),e=t.text(),t=t.attr("group-id"),i=colorPalette[t];indx=usernames[t].indexOf(e),color=i[indx%i.length],($comment=m(this).find(".comment")).css("background-color",color),"light"===t&&$comment.css("color","black")})}function u(t){for(var e=t.find(".accordion"),i=0;i<e.length;i++)e[i].addEventListener("click",function(){this.classList.toggle("active"),m(this).nextUntil("li.accordion").each(function(){this.classList.toggle("active")})}),i==e.length-1&&(e[i].classList.toggle("active"),m(e[i]).nextUntil("li.accordion").each(function(){this.classList.toggle("active")}))}function g(){m(window).on("resize scroll",function(){m(".subform .right .comments").each(function(){var e,t,i=m(this);"true"!==i.data("comments-loaded")&&i.isInViewport()&&(i.data("comments-loaded","true"),i=(e=i).data("question-id"),t=e.data("thread-id"),m.get("./@@ast-comments?q="+i+"&thread_id="+t,function(t){e.html(t),f(),u(e)}))})})}function p(){var t=m("#report-nav-toggle"),e=m(".report-nav.sticky"),i=m("#assessment-edit-infobox"),n=i.children().length,o=m(".form-right-side.fixed-save-btn");0<n&&e.length?(e.addClass("has-infobox"),i.show().css("display","inline-block"),n=t.position().left-16,o.length&&(n=o.position().left),n-=i.width(),i.css("left",n+"px")):(e.removeClass("has-infobox"),i.hide())}m.fn.isInViewport=function(){var t=m(this).offset().top,e=t+m(this).outerHeight(),i=m(window).scrollTop(),n=i+m(window).height();return i<e&&t<n},m(document).ready(function(){var t,e;function i(){var n=[],o=m("<div>"),a=m("div#assessment-edit-infobox");a.empty(),m(".subform .left select option:selected").each(function(){var t=m(this).text(),e=m(this).parent().attr("id").split("_").slice(-2),i=e[0],e=e[1];e.match("[^a-zA-Z]")&&(e=e.split("-").join(".")),"Not relevant"==t&&(o.append(m("<span>").addClass("infobox-popover").append(i+": "+e)),-1===n.indexOf(e)&&n.push(e))}),n.forEach(function(t,e,i){a.append(m("<span>").attr("class","info-item").append(t))}),a.attr("class","help-popover").attr("data-trigger","hover").attr("data-html","true").attr("data-placement","bottom").attr("data-content",o.html()).attr("data-original-title","'Not relevant' option selected for the following questions:").popover(),0!==n.length?a.append(m('<i class="glyphicon glyphicon-exclamation-sign infobox-icon">')):a.hide()}h(),g(),m(".subform .right .textline button").on("click",function(){var t=m(this),e=m(".comments",t.closest(".right")),i=m("textarea",t.closest(".textline")),t=e.data("question-id"),n=e.data("thread-id"),o=i.val();if(!o)return!1;return m.post("./@@add_comment",{text:o,q:t,thread_id:n},function(t){h(),e.html(t),i.val(""),f(),u(e)}),!1}),l=m(".right.disc-tl"),c=m(".right.disc-ec"),l.length,c.length,m(".comm-hide").click(function(){m(this).siblings(".comments").find("li").each(function(){m(this).addClass("active")})}),m(".right.discussion .comments").click(function(){($thisComm=m(this).closest(".right")).hasClass("inactive")&&$thisComm.toggleClass("inactive")}),m("#comp-national-descriptor div.subform.disabled div.left").find("textarea").each(function(){m(this).attr("disabled",!0)}),m(".kssattr-formname-edit-assessment-data-2018").submit(function(){m(":disabled").each(function(){m(this).removeAttr("disabled")})}),m("#comp-national-descriptor div.subform div.left div.assessment-form-input").find("option:contains('No value'), span.select2-chosen:contains('No value')").each(function(){m(this).text("-")}),m(".edit-recommendation-feedback div.assessment-form-input").find("option:contains('No value'), span.select2-chosen:contains('No value')").each(function(){m(this).remove()}),e=t=!1,l=m(".fields-container"),m("#comp-national-descriptor form").submit(function(){t=!0}),l.on("change","input, textarea, select",function(t){e=!0}),m(window).bind("beforeunload",function(){if(e&&!t)return"You have unsaved changes. Do you want to leave this page?"}),c=l.find(".select2-container"),l=l.find("textarea"),c.closest(".fields-container-row").addClass("flex-select"),l.closest(".fields-container-row").addClass("flex-textarea"),i(),m("select").change(function(){i(),p()}),m("i.question-intro").click(function(){var t=m(this).data().text,e=m(this).data().questionid;m("#question-intro .modal-body").html(t),m("#question-intro .modal-title .modal-question-id").text(e)}),m(".help-popover").popover(),m(".subform .right .comments").mouseenter(function(){var s,c;(s=m(this)).find(".comms .comm-del").each(function(){var t=m(this);"true"!==(clickEventExists=t.data("click-event-setup"))&&(t.data("click-event-setup","true"),t.on("click",function(){var t=m(this),e=m(".comments",t.closest(".right")),i=t.siblings(".comm-crtr").find(".comment-name").text(),n=t.siblings(".comm-crtr").find(".comment-time").text(),t=t.siblings(".comment").text(),o=s.data("question-id"),a=s.data("thread-id");confirm("Are you sure you want to delete the comment '"+t+"'?")&&m.post("./@@del_comment",{comm_name:i,comm_time:n,text:t,q:o,thread_id:a},function(t){h(),e.html(t),f(),u(s)})}))}),(c=m(this)).find(".comms .comm-edit").each(function(){var t=m(this);"true"!==(clickEventExists=t.data("click-event-setup"))&&(t.data("click-event-setup","true"),t.on("click",function(){var t=m(this),e=m(".comments",t.closest(".right")),i=t.siblings(".comm-crtr").find(".comment-name").text(),n=t.siblings(".comm-crtr").find(".comment-time").text(),t=t.siblings(".comment").text(),o=c.data("question-id"),a=c.data("thread-id"),s=m("#edit-comment-modal");m("#comment-original-text",s).text(t),m("#new_comment",s).val(t),m("#comm_original",s).val(t),m("#comm_name",s).val(i),m("#comm_time",s).val(n),m("#q",s).val(o),m("#thread_id",s).val(a),m("#form-edit-comment").data("comel",e),m("#form-edit-comment").data("el",c)}))})}),m("#form-edit-comment").submit(function(t){var e,i;t.preventDefault(),m(this).hasClass("form-submitted")||(m(this).addClass("form-submitted"),m("#edit-comment-modal *").css("cursor","wait"),e=m(this).data("comel"),i=m(this).data("el"),m.post("./@@edit_comment",m(this).serialize(),function(t){h(),e.html(t),f(),u(i),m("#edit-comment-modal *").css("cursor","default"),jQuery.noConflict(),m("#edit-comment-modal").modal("toggle"),m("#form-edit-comment").removeClass("form-submitted")}))});var n,o,a=m(window),s=(m(".subform").each(function(){var t,e=m(this),i=e.find(".right"),n=e.find(".left").innerHeight();i.innerHeight(n+30),a.resize(function(){clearTimeout(t),t=setTimeout(function(){i=e.find(".right"),n=e.find(".left").innerHeight(),i.innerHeight(n)},100)})}),m(".form-right-side")),c=m(".report-nav"),r=0,d=0,l=(s.offset()&&(r=s.offset().top),0<c.length&&(d=c.offset().top),o=a.height()-2*s.height(),s.find("#form-buttons-translate"));l.addClass("btn-secondary"),-1==window.location.pathname.indexOf("art10")&&l.css("display","none"),a.scroll(function(){var t=(n=a.scrollTop())+o<r&&d<=n;s.toggleClass("fixed-save-btn",t),p()})})}(jQuery);
//# sourceMappingURL=assessment-edit.js.map