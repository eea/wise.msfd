!function(h){function m(){var t="s--Plone"+window.location.pathname.split("/").slice(0,-1).join("-");document.cookie=t+"="+Date.now()+";path=/"}function f(){colorPalette={light:["lightgreen","lightblue","lightgoldenrodyellow","lightgrey"],dark:["darkgreen","darkblue","darkmagenta","darkred"]},usernames={light:[],dark:[]},h(".comment-name").each(function(){var t=h(this).attr("group-id"),e=h(this).text();-1===usernames[t].indexOf(e)&&usernames[t].push(e)}),h(".comms").each(function(){var t=h(this).find(".comment-name"),e=t.text(),t=t.attr("group-id"),n=colorPalette[t];indx=usernames[t].indexOf(e),color=n[indx%n.length],($comment=h(this).find(".comment")).css("background-color",color),"light"===t&&$comment.css("color","black")})}function u(t){for(var e=t.find(".accordion"),n=0;n<e.length;n++)e[n].addEventListener("click",function(){this.classList.toggle("active"),h(this).nextUntil("li.accordion").each(function(){this.classList.toggle("active")})}),n==e.length-1&&(e[n].classList.toggle("active"),h(e[n]).nextUntil("li.accordion").each(function(){this.classList.toggle("active")}))}function g(){h(window).on("resize scroll",function(){h(".subform .right .comments").each(function(){var e,t,n=h(this);"true"!==n.data("comments-loaded")&&n.isInViewport()&&(n.data("comments-loaded","true"),n=(e=n).data("question-id"),t=e.data("thread-id"),h.get("./@@ast-comments?q="+n+"&thread_id="+t,function(t){e.html(t),f(),u(e)}))})})}function p(){var t=h("#report-nav-toggle"),e=h(".report-nav.sticky"),n=h("#assessment-edit-infobox"),i=n.children().length,o=h(".form-right-side.fixed-save-btn");0<i&&e.length?(e.addClass("has-infobox"),n.show().css("display","inline-block"),i=t.position().left-16,o.length&&(i=o.position().left),i-=n.width(),n.css("left",i+"px")):(e.removeClass("has-infobox"),n.hide())}h.fn.isInViewport=function(){var t=h(this).offset().top,e=t+h(this).outerHeight(),n=h(window).scrollTop(),i=n+h(window).height();return n<e&&t<i},h(document).ready(function(){var t,e;function n(){var i=[],o=h("<div>"),s=h("div#assessment-edit-infobox");s.empty(),h(".subform .left select option:selected").each(function(){var t=h(this).text(),e=h(this).parent().attr("id").split("_").slice(-2),n=e[0],e=e[1];e.match("[^a-zA-Z]")&&(e=e.split("-").join(".")),"Not relevant"==t&&(o.append(h("<span>").addClass("infobox-popover").append(n+": "+e)),-1===i.indexOf(e)&&i.push(e))}),i.forEach(function(t,e,n){s.append(h("<span>").attr("class","info-item").append(t))}),s.attr("class","help-popover").attr("data-trigger","hover").attr("data-html","true").attr("data-placement","bottom").attr("data-content",o.html()).attr("data-original-title","'Not relevant' option selected for the following questions:").popover(),0!==i.length?s.append(h('<i class="glyphicon glyphicon-exclamation-sign infobox-icon">')):s.hide()}m(),g(),h(".subform .right .textline button").on("click",function(){var t=h(this),e=h(".comments",t.closest(".right")),n=h("textarea",t.closest(".textline")),t=e.data("question-id"),i=e.data("thread-id"),o=n.val();if(!o)return!1;return h.post("./@@add_comment",{text:o,q:t,thread_id:i},function(t){m(),e.html(t),n.val(""),f(),u(e)}),!1}),l=h(".right.disc-tl"),c=h(".right.disc-ec"),l.length,c.length,h(".comm-hide").click(function(){h(this).siblings(".comments").find("li").each(function(){h(this).addClass("active")})}),h(".right.discussion .comments").click(function(){($thisComm=h(this).closest(".right")).hasClass("inactive")&&$thisComm.toggleClass("inactive")}),h("#comp-national-descriptor div.subform.disabled div.left").find("textarea").each(function(){h(this).attr("disabled",!0)}),h(".kssattr-formname-edit-assessment-data-2018").submit(function(){h(":disabled").each(function(){h(this).removeAttr("disabled")})}),h("#comp-national-descriptor div.subform div.left div.assessment-form-input").find("option:contains('No value'), span.select2-chosen:contains('No value')").each(function(){h(this).text("-")}),h(".edit-recommendation-feedback div.assessment-form-input").find("option:contains('No value'), span.select2-chosen:contains('No value')").each(function(){h(this).remove()}),e=t=!1,l=h(".fields-container"),h("#comp-national-descriptor form").submit(function(){t=!0}),l.on("change","input, textarea, select",function(t){e=!0}),h(window).bind("beforeunload",function(){if(e&&!t)return"You have unsaved changes. Do you want to leave this page?"}),c=l.find(".select2-container"),l=l.find("textarea"),c.closest(".fields-container-row").addClass("flex-select"),l.closest(".fields-container-row").addClass("flex-textarea"),n(),h("select").change(function(){n(),p()}),h(".help-popover").popover(),h(".subform .right .comments").mouseenter(function(){var a;(a=h(this)).find(".comms .comm-del").each(function(){var t=h(this);"true"!==(clickEventExists=t.data("click-event-setup"))&&(t.data("click-event-setup","true"),t.on("click",function(){var t=h(this),e=h(".comments",t.closest(".right")),n=t.siblings(".comm-crtr").find(".comment-name").text(),i=t.siblings(".comm-crtr").find(".comment-time").text(),t=t.siblings(".comment").text(),o=a.data("question-id"),s=a.data("thread-id");confirm("Are you sure you want to delete the comment '"+t+"'?")&&h.post("./@@del_comment",{comm_name:n,comm_time:i,text:t,q:o,thread_id:s},function(t){m(),e.html(t),f(),u(a)})}))})});var i,o,s=h(window),a=(h(".subform").each(function(){var t,e=h(this),n=e.find(".right"),i=e.find(".left").innerHeight();n.innerHeight(i+30),s.resize(function(){clearTimeout(t),t=setTimeout(function(){n=e.find(".right"),i=e.find(".left").innerHeight(),n.innerHeight(i)},100)})}),h(".form-right-side")),c=h(".report-nav"),r=0,d=0,l=(a.offset()&&(r=a.offset().top),0<c.length&&(d=c.offset().top),o=s.height()-2*a.height(),a.find("#form-buttons-translate"));l.addClass("btn-secondary"),-1==window.location.pathname.indexOf("art10")&&l.css("display","none"),s.scroll(function(){var t=(i=s.scrollTop())+o<r&&d<=i;a.toggleClass("fixed-save-btn",t),p()})})}(jQuery);
//# sourceMappingURL=assessment-edit.js.map