{"version":3,"file":"msfd_search.js","sources":["../../src/js/msfd_search.js"],"sourcesContent":["/* global window, document, jQuery */\n(function (window, document, $) {\n  /*\n   * ****************************************************\n   * Page elements init\n   * ****************************************************\n   * */\n  var exceptVal = ['all', 'none', 'invert', 'apply'];\n  var selectorFormContainer = '.wise-search-form-container';\n  var selectorLeftForm = '#wise-search-form';\n\n  var sessionStore = storageFactory(sessionStorage);\n  /*\n   * Vars and $ plugins\n   *\n   * */\n  $.randomString = function () {\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz';\n    var string_length = 8;\n    var randomstring = '';\n    for (var i = 0; i < string_length; i++) {\n      var rnum = Math.floor(Math.random() * chars.length);\n      randomstring += chars.substring(rnum, rnum + 1);\n    }\n    return randomstring;\n  };\n\n  $.getMultipartData = function (frmName, newBoundary) {\n    //Start multipart formatting\n    var initBoundary = newBoundary || $.randomString();\n    var strBoundary = '--' + initBoundary;\n    var strMultipartBody = '';\n    var strCRLF = '\\r\\n';\n\n    var iname = $(frmName).attr('id');\n\n    var formData = $(frmName).serializeArray();\n    //Create multipart for each element of the form\n\n    if (formData.length === 0) {\n      return false;\n    }\n\n    var res = [];\n    var vals = {};\n\n    $.each(formData, function (indx, val) {\n      strMultipartBody +=\n        strBoundary +\n        strCRLF +\n        'Content-Disposition: form-data; name=\"' +\n        val.name +\n        '\"' +\n        strCRLF +\n        strCRLF +\n        val.value +\n        strCRLF;\n\n      res.push(val.name);\n      if (!vals[val.name]) vals[val.name] = [];\n      vals[val.name].push(val.value);\n    });\n\n    //End the body by delimiting it\n    strMultipartBody += strBoundary + '--' + strCRLF;\n\n    //Return boundary without -- and the multipart content\n    return [initBoundary, strMultipartBody, vals];\n  };\n\n  var loading = false;\n\n  /*\n   * Styling and hiding\n   *\n   */\n  function initStyling() {\n    var ajaxSpinner = $('#ajax-spinner');\n    $('body').append(ajaxSpinner.clone(true).attr('id', 'ajax-spinner2'));\n    ajaxSpinner.remove();\n\n    $('.button-field').addClass('btn');\n    $(selectorFormContainer + ' #s2id_form-widgets-marine_unit_id')\n      .parentsUntil('.field')\n      .parent()\n      .hide();\n\n    $('#form-buttons-continue').hide('fast');\n\n    var $article13 = $('#article132022form');\n    var $article13form = $('#article13form');\n    if ($article13.length && $article13form.length) {\n      $article13.insertAfter($article13form);\n    }\n\n    // var $downloadBtn = $('#form-buttons-download');\n    // var $centerSection = $('.center-section');\n    // var $form = $('#wise-search-form-container > form');\n\n    // if ($downloadBtn.length > 0) {\n    //   $centerSection.find('#form-buttons-download').remove();\n    //   var $newBtn = $('<button/>', {\n    //     id: 'form-buttons-download',\n    //     type: 'submit',\n    //     form: $form.attr('id'),\n    //     name: 'form.buttons.download',\n    //     class: 'ui button primary inverted',\n    //     text: 'Download as spreadsheet',\n    //   });\n\n    //   $centerSection.append($newBtn);\n    //   $downloadBtn.remove();\n    // }\n  }\n\n  /*\n   * CHECKBOXES functions\n   * */\n  function generateControlDiv() {\n    var spAll =\n      '<div class=\"controls\">' +\n      '<span>Select :</span><a data-value=\"all\"><label>' +\n      '<span class=\"label\">All</span></label></a>';\n    var spClear =\n      '<a data-value=\"none\"><label><span class=\"label\">Clear all</span></label></a>';\n    var invertSel =\n      '<a data-value=\"invert\"><label><span class=\"label\">Invert selection</span></label></a>' +\n      '<div class=\"btn btn-default apply-filters\" data-value=\"apply\"><span>Apply filters</span></div>' +\n      '<div class=\"ui-autocomplete\">' +\n      '<span class=\"search-span\">' +\n      '<input class=\"ui-autocomplete-input\" type=\"text\" placeholder=\"Quick search\"/>' +\n      '<span class=\"clear-btn\"></span>' +\n      '</div>' +\n      '</div>';\n    return spAll + spClear + invertSel;\n  }\n\n  function searchAutoComplete(evtarget, $field) {\n    var cheks2 = $field.find('.option .label:not(.horizontal) ');\n    var labels = cheks2.parentsUntil('.option').parent();\n    var inputs = labels.find('input');\n    var options = labels.parent();\n    var no_results = options.find('.noresults');\n\n    if ($(evtarget).val() === '') {\n      no_results.addClass('hidden');\n      labels.removeClass('hidden');\n      var data = $field\n        .find('.panel-content > div:not(.controls)')\n        .data('checked_items');\n\n      if (data) {\n        $.each(inputs, function (idx, el) {\n          // 96264 in case we have an empty searchfield checked items\n          // saved in previous query\n          el.checked = data.indexOf(el.id) !== -1;\n        });\n      }\n      return true;\n    }\n\n    $field.find('.apply-filters').show();\n    labels.removeClass('hidden');\n\n    var toSearch = $(evtarget).val().toLowerCase().replace(/\\s/g, '_');\n\n    var matcher = new RegExp($.ui.autocomplete.escapeRegex(toSearch), 'i');\n\n    var temp = {};\n    var checksLabels = $field\n      .find('.option .label:not(.horizontal) ')\n      .map(function (ind, item) {\n        temp[$(item).text().toLowerCase()] = $(item)\n          .text()\n          .toLowerCase()\n          .replace(/\\s/g, '_');\n\n        return $(item).text().toLowerCase().replace(/\\s/g, '_');\n      });\n\n    var found = [];\n    $.each(temp, function (indx, item) {\n      if (!matcher.test(item)) {\n        found.push(indx);\n      }\n    });\n\n    var tohide = cheks2.filter(function (idx, elem) {\n      return found.indexOf($(elem).text().toLowerCase()) !== -1;\n    });\n\n    var toshow = cheks2.filter(function (idx, elem) {\n      return found.indexOf($(elem).text().toLowerCase()) === -1;\n    });\n    $.each(toshow, function (ind, item) {\n      $(item)\n        .parentsUntil('.option')\n        .parent()\n        .find(\"[type='checkbox']\")\n        .prop('checked', true);\n    });\n\n    $.each(tohide, function (inx, item) {\n      $(item)\n        .parentsUntil('.option')\n        .parent()\n        .find(\"[type='checkbox']\")\n        .prop('checked', false);\n      $(item)\n        .parentsUntil('.option')\n        .parent()\n        .find(\"input[type='checkbox']\")\n        .prop('checked', false);\n      $(item)\n        .parentsUntil('.option')\n        .parent()\n        .find(\"input[type='checkbox']\")\n        .removeAttr('checked');\n      $(item).parentsUntil('.option').parent().addClass('hidden');\n    });\n\n    if (tohide.length === cheks2.length) {\n      no_results.removeClass('hidden');\n    } else {\n      no_results.addClass('hidden');\n    }\n  }\n\n  function addAutoComplete($field) {\n    var $input = $field.find('.ui-autocomplete-input');\n    $input.autocomplete({\n      minLength: 0,\n      source: [],\n      search: function (event) {\n        searchAutoComplete(event.target, $field);\n      },\n      create: function () {\n        var that = this;\n        var $removeBtn = $(this).closest('.ui-autocomplete').find('.clear-btn');\n        $removeBtn.on('click', function (ev) {\n          $(that).val('');\n          $(that).trigger('change');\n          searchAutoComplete(that, $field);\n        });\n      },\n    });\n  }\n\n  function getAppliedFilters() {\n    window.WISE = window.WISE || {};\n    window.WISE.appliedFilters = {};\n\n    $(selectorFormContainer + ', ' + selectorLeftForm)\n      .find('[data-fieldname]')\n      .each(function () {\n        var $f = $(this);\n        var fieldName = $f.find('> label.horizontal').text().trim();\n\n        var values = $f\n          .find(\"input[type='checkbox']:checked\")\n          .map(function () {\n            return $(this).closest('.option').text().trim();\n          })\n          .get();\n\n        window.WISE.appliedFilters[fieldName] = values;\n      });\n\n    $(document).trigger('filters:applied');\n  }\n\n  function addActiveFilters() {\n    var $section = $('.active-filters-section');\n    var $list = $('.active-filters-list');\n    var $header = $section.find('.active-filters-header');\n    var $icon = $header.find('i.fa');\n\n    $list.hide();\n\n    function renderFilters() {\n      $list.empty();\n\n      var applied = (window.WISE && window.WISE.appliedFilters) || {};\n\n      $.each(applied, function (fieldName, values) {\n        if (!values || !values.length) return;\n\n        var $group = $('<div class=\"active-filter-group\"></div>');\n        $group.append(\n          '<span class=\"filter-group-title\">' + fieldName + ':</span>',\n        );\n\n        values.forEach(function (text) {\n          var $checkbox = $('[data-fieldname]')\n            .filter(function () {\n              return (\n                $(this).find('> label.horizontal').text().trim() === fieldName\n              );\n            })\n            .find(\"input[type='checkbox']\")\n            .filter(function () {\n              return $(this).parent().text().trim() === text;\n            });\n\n          var checkboxId = $checkbox.attr('id') || '';\n\n          var $tag = $(\n            '<span class=\"active-filter-item\" data-id=\"' +\n              checkboxId +\n              '\">' +\n              text +\n              '<button type=\"button\" class=\"ui button clear-filter\">' +\n              '<i class=\"fa fa-times\" aria-hidden=\"true\"></i>' +\n              '</button>' +\n              '</span>',\n          );\n\n          $tag.find('.clear-filter').on('click', function (e) {\n            e.preventDefault();\n\n            if (checkboxId) {\n              var $cb = $('#' + checkboxId);\n              if ($cb.length && $cb.is(':checked')) {\n                $cb.closest('.option').trigger('click');\n              }\n            }\n          });\n\n          $group.append($tag);\n        });\n\n        $list.append($group);\n      });\n    }\n\n    $header\n      .off('click.activeFiltersToggle')\n      .on('click.activeFiltersToggle', function () {\n        $list.slideToggle(200);\n        $icon.toggleClass('fa-chevron-up fa-chevron-down');\n      });\n\n    $(document)\n      .off('filters:applied.render')\n      .on('filters:applied.render', renderFilters);\n\n    renderFilters();\n  }\n\n  function addCheckboxPanel($field, fieldId, cheks) {\n    var $wrapper = $('.msfd-search-wrapper');\n\n    $field.addClass('panel-group');\n\n    var $label = $field.find('> label.form-label');\n    $label.addClass('panel-title panel-heading');\n\n    var $content = $label.next('.panel-content');\n    if (!$content.length) {\n      $label.nextAll().wrapAll('<div class=\"panel-content\"></div>');\n      $content = $label.next('.panel-content');\n    }\n\n    var $controls = $content.children('.controls');\n    if (!$controls.length) {\n      var all = generateControlDiv();\n      $content.prepend(all);\n    } else if ($controls.length > 1) {\n      $controls.slice(1).remove();\n    }\n\n    var chekspan = $content.find('> div:not(.controls)');\n    chekspan.addClass('panel-default');\n\n    // $content.hide().removeClass('open');\n    // $label.removeClass('open');\n\n    // $label.off('click.accordion').on('click.accordion', function (e) {\n    //   e.stopPropagation();\n\n    //   var $thisLabel = $(this);\n    //   var $thisContent = $thisLabel.next('.panel-content');\n\n    //   if ($thisContent.is(':visible')) {\n    //     $thisContent.hide().removeClass('open');\n    //     $thisLabel.removeClass('open');\n\n    //     if ($('.panel-content.open').length === 0) {\n    //       $wrapper.find('.dimmer').remove();\n    //     }\n    //   } else {\n    //     $('.panel-content').hide().removeClass('open');\n    //     $('.panel-title').removeClass('open');\n    //     $wrapper.find('.dimmer').remove();\n\n    //     $thisContent.show().addClass('open');\n    //     $thisLabel.addClass('open');\n\n    //     $wrapper.append('<div class=\"dimmer\"/>');\n    //   }\n    // });\n\n    // $(document)\n    //   .off('click.accordionOutside')\n    //   .on('click.accordionOutside', function (e) {\n    //     if ($(e.target).closest('.panel-group').length === 0) {\n    //       $('.panel-content').hide().removeClass('open');\n    //       $('.panel-title').removeClass('open');\n    //       $wrapper.find('.dimmer').remove();\n    //     }\n    //   });\n\n    chekspan.append(\"<span class='noresults hidden'>No results found</span>\");\n    chekspan.data('checked_items', []);\n\n    var data = chekspan.data('checked_items');\n    $.each($field.find('input:checked'), function (idx, el) {\n      data.push(el.id);\n    });\n\n    addAutoComplete($field);\n\n    var $subforms = $('.panel-title').closest('.subform');\n    if ($subforms.length && !$subforms.parent().hasClass('subforms-wrapper')) {\n      $subforms.wrapAll('<div class=\"subforms-wrapper\"></div>');\n      var $form = $subforms.first().closest('form');\n      if ($form.length) {\n        $form.append($form.find('.subforms-wrapper'));\n      }\n    }\n  }\n\n  function sortCheckboxesByChecked($field) {\n    if (\n      window.WISE !== undefined &&\n      window.WISE.blocks !== undefined &&\n      window.WISE.blocks.indexOf($field.attr('id')) !== -1\n    ) {\n      return;\n    }\n    var arr = [];\n    $.each(\n      $field.find(\".option input[type='checkbox']:not(:checked)\"),\n      function (ix, ch) {\n        arr.push($(ch).parent());\n      },\n    );\n    var found = $field.find(\".option input[type='checkbox']:checked\");\n    var foundArr = [];\n    if (found.length > 0) {\n      $.each(found, function (ix, item) {\n        foundArr.push($(item).parent());\n      });\n    }\n    var all = foundArr.concat(arr);\n\n    $.each(all, function (ix, ch) {\n      $field.find('.panel').append(ch);\n    });\n  }\n\n  // enable autosubmit handler\n  function fieldAutoSubmitSetup(fieldId, $field) {\n    $('#' + fieldId).on('click', '.option', function () {\n      var self = this;\n      $('#ajax-spinner2').hide();\n      //window.WISE.blocks = window.WISE.blocks.sort().filter((x, i, a) => !i || x != a[i-1]);\n\n      if (\n        window.WISE.blocks.indexOf(\n          $(this).parentsUntil('.field').parent().attr('id'),\n        ) !== -1\n      ) {\n        sortCheckboxesByChecked($field);\n      } else {\n        //TODO : check if apply-filters shown\n        // each checkbox does auto submit\n        window.setTimeout(function () {\n          $(\n            selectorFormContainer + ' .formControls #form-buttons-continue',\n          ).trigger('click', { button: self });\n        }, 300);\n      }\n    });\n  }\n\n  function generateCheckboxes($fields, $fieldsnr) {\n    var count = $fieldsnr;\n\n    $fields.each(function (indx, field) {\n      var $field = $(field);\n      var cheks = $field.find('.option');\n      var allcheckboxes = cheks.find(\"input[type='checkbox']\");\n\n      var hasChecks = allcheckboxes.length > 0;\n      // has checkboxes\n      if (hasChecks) {\n        var fieldId = $field.attr('id');\n\n        fieldAutoSubmitSetup(fieldId, $field);\n\n        //tooltips\n        cheks.each(function (idx) {\n          var text = $(cheks[idx]).text();\n          $(cheks[idx]).attr('title', text.trim());\n        });\n\n        addCheckboxPanel($field, fieldId, cheks);\n        addActiveFilters($field);\n\n        $field.find('.search-icon').on('click', function (ev) {\n          $(ev.target).parent().find('input').trigger('focus');\n        });\n\n        sortCheckboxesByChecked($field);\n      }\n      if (!--count)\n        $(selectorFormContainer + ',' + selectorLeftForm).animate(\n          { opacity: 1 },\n          1000,\n        );\n    });\n  }\n\n  function checkboxHandlerAll(ev) {\n    ev.preventDefault();\n\n    var par = $(this).parent().parent();\n\n    window.WISE.blocks.push($(this).parentsUntil('.field').parent().attr('id'));\n\n    par.find('.apply-filters').show();\n    var rest = filterInvalidCheckboxes($(par).find(\"[type='checkbox']\"));\n\n    $.each(rest, function (idx) {\n      if ($(rest[idx]).val() !== 'all' && $(rest[idx]).val() !== 'none')\n        $(rest[idx]).prop('checked', true);\n    });\n  }\n\n  function checkboxHandlerNone(ev) {\n    ev.preventDefault();\n\n    $(this).prop('checked', false);\n    var par = $(this).parent().parent();\n    par.find('.apply-filters').show();\n    var rest = filterInvalidCheckboxes($(par).find(\"[type='checkbox']\"));\n\n    window.WISE.blocks.push($(this).parentsUntil('.field').parent().attr('id'));\n\n    $.each(rest, function (idx) {\n      $(rest[idx]).prop('checked', false);\n    });\n  }\n\n  function checkboxHandlerInvert(ev) {\n    ev.preventDefault();\n    $(this).prop('checked', false);\n\n    var par = $(this).parent().parent();\n    par.find('.apply-filters').show();\n\n    window.WISE.blocks.push($(this).parentsUntil('.field').parent().attr('id'));\n\n    var rest = filterInvalidCheckboxes($(par).find(\"[type='checkbox']\"));\n\n    var checked = rest.filter(function (ind, item) {\n      return $(item).is(':checked');\n    });\n\n    var unchecked = rest.filter(function (ind, item) {\n      return !$(item).is(':checked');\n    });\n\n    $.each(checked, function (idx) {\n      $(checked[idx]).prop('checked', false);\n    });\n\n    $.each(unchecked, function (idx) {\n      $(unchecked[idx]).prop('checked', true);\n    });\n  }\n\n  function addCheckboxHandlers() {\n    var $controls = $('.controls');\n    $controls.on('click', \"a[data-value='all']\", checkboxHandlerAll);\n    $controls.on('click', \"a[data-value='none']\", checkboxHandlerNone);\n    $controls.on('click', \"a[data-value='invert']\", checkboxHandlerInvert);\n\n    $controls.one('click', '.apply-filters', function () {\n      $(selectorFormContainer + \" [name='form.widgets.page']\").val(0);\n      $(\n        selectorFormContainer + ' .formControls #form-buttons-continue',\n      ).trigger('click', { button: this });\n    });\n  }\n\n  function filterInvalidCheckboxes(cbxs) {\n    return cbxs.filter(function (idx, item) {\n      return exceptVal.indexOf($(item).val()) === -1;\n    });\n  }\n\n  function addCheckboxLabelHandlers() {\n    var allch = $(selectorFormContainer + ', ' + selectorLeftForm).find(\n      '[data-fieldname]',\n    );\n\n    var triggerClick = function (chV, ev) {\n      // reset page\n      $(selectorFormContainer + \" [name='form.widgets.page']\").val(0);\n\n      if (exceptVal.indexOf(chV) === -1) {\n        if ($(ev.target).is(\"input[type='checkbox']\")) {\n          // if the target IS the checkbox, trigger change directly\n          $(ev.target).trigger('change');\n        } else {\n          // otherwise, find the checkbox inside\n          $(ev.target).find(\"input[type='checkbox']\").trigger('click');\n        }\n      }\n    };\n\n    // listener for click on the whole span\n    allch.off('click', '.form-check, input[type=\"checkbox\"]');\n    allch.on('click', '.form-check, input[type=\"checkbox\"]', function (ev) {\n      ev.stopPropagation();\n      $('#ajax-spinner2').hide();\n\n      var $checkbox = $(this).is('input[type=\"checkbox\"]')\n        ? $(this)\n        : $(this).find(\"input[type='checkbox']\");\n\n      var checkboxV = $checkbox.val();\n\n      if (\n        window.WISE.blocks.indexOf($checkbox.closest('.field').attr('id')) !==\n        -1\n      ) {\n        $checkbox.prop(\"checked\", !$checkbox.prop(\"checked\"));\n        // return false;\n      } else {\n        triggerClick(checkboxV, ev);\n      }\n    });\n  }\n  /*\n   * CHECKBOXES functions END\n   * */\n\n  /*\n   * SELECT2 functions\n   * */\n  function setupRightSelects2(selector) {\n    var forbiddenIDs = [\n      'form-widgets-member_states-from',\n      'form-widgets-member_states-to',\n    ];\n    var selectorFormCont = selector || selectorFormContainer;\n\n    $(selectorFormCont + ' select').each(function (ind, selectElement) {\n      var selectedElementID = $(selectElement).attr('id');\n      if (forbiddenIDs.indexOf(selectedElementID) !== -1) {\n        return false;\n      }\n\n      $(selectElement).addClass('js-example-basic-single');\n      var lessOptions = $(selectElement).find('option').length < 10;\n\n      var $wise_search_form = $(selectorFormCont);\n\n      var options = {\n        placeholder: 'Select an option',\n        closeOnSelect: true,\n        dropdownAutoWidth: true,\n        width: '100%',\n        theme: 'flat',\n      };\n      if (lessOptions) options.minimumResultsForSearch = Infinity;\n\n      $(selectElement).select2(options);\n\n      $(selectorFormCont + ' #s2id_form-widgets-marine_unit_id').hide();\n\n      var removePaginationButtons = function () {\n        // $wise_search_form.find(\"[name='form.buttons.prev']\").remove();\n        // $wise_search_form.find(\"[name='form.buttons.next']\").remove();\n        $wise_search_form.find(\"[name='form.widgets.page']\").remove();\n      };\n\n      $(selectElement).on('select2-selecting', function (ev) {\n        // remove results following form-widgets-article select element\n        // as we want to reset each facet to it's initial value if we change form\n        if ($(this).attr('id') === 'form-widgets-article') {\n          //$(ev.target).closest(\".form-right-side\").next().remove();\n        }\n\n        removePaginationButtons();\n\n        var self = this;\n        window.setTimeout(function () {\n          $(selectorFormCont + ' .formControls #form-buttons-continue').trigger(\n            'click',\n            { select: self },\n          );\n        }, 300);\n      });\n    });\n  }\n\n  function formatArticle(article) {\n    var el = $(article.element[0]);\n    var subtitle = el.attr('data-subtitle');\n\n    return '<span>' + el.attr('data-maintitle') + ': ' + subtitle + '</span>';\n  }\n\n  function marineUnitSelect() {\n    var $selectArticle = $('#mobile-select-article');\n\n    var moptions = {\n      placeholder: 'Select an option',\n      closeOnSelect: true,\n      // dropdownAutoWidth: true,\n      // width: 'auto',\n      width: 'element',\n      theme: 'flat',\n      minimumResultsForSearch: 20,\n      formatSelection: formatArticle,\n      formatResult: formatArticle,\n      containerCssClass: 'mobile-select-article',\n    };\n\n    if ($.fn.select2 !== undefined) {\n      $selectArticle.select2(moptions);\n      $selectArticle.one('select2-selecting', function (ev) {\n        document.location.href = document.location.pathname.split('/').slice(0, -1).join('/') + ev.choice.id.replace(\"./\", '/');\n      });\n    }\n  }\n\n  function setupLeftSelect2() {\n    var marineUnitTriggerSelector = '#marine-unit-trigger';\n    if (\n      $(selectorLeftForm + ' select:not(.notselect)').hasClass(\n        'js-example-basic-single',\n      )\n    ) {\n      return false;\n    }\n    $(selectorLeftForm + ' select:not(.notselect)')\n      .addClass('js-example-basic-single')\n      .each(function (ind, selectElement) {\n        var options = {\n          placeholder: 'Select an option',\n          closeOnSelect: true,\n          dropdownAutoWidth: false,\n          width: 'auto',\n          theme: 'flat',\n          minimumResultsForSearch: 20,\n          allowClear: true,\n          dropdownParent: '#marine-unit-trigger',\n          dropdownAdapter: 'AttachContainer',\n          containerCssClass: 'select2-top-override',\n          dropdownCssClass: 'select2-top-override-dropdown',\n          debug: true,\n        };\n\n        $(selectElement).select2(options);\n\n        // david\n        $(selectElement)\n          .parentsUntil('.field')\n          .parent()\n          .prepend('<h4>Marine Unit ID: </h4>');\n\n        $(selectElement).on('select2-open', function () {\n          var trh = $(marineUnitTriggerSelector).offset().top;\n          $(marineUnitTriggerSelector + ' .arrow').hide();\n          $('.select2-top-override-dropdown').css({\n            top:\n              trh +\n              $(marineUnitTriggerSelector).height() -\n              $(marineUnitTriggerSelector + ' .arrow').height() +\n              'px',\n            'margin-top': '12' + 'px !important',\n          });\n        });\n\n        $(selectElement).on('select2-selecting', function (ev) {\n          $(selectorFormContainer + \" [name='form.widgets.page']\").val(0);\n          $(selectorFormContainer + ' #form-widgets-marine_unit_id')\n            .select2()\n            .val(ev.val)\n            .trigger('change');\n          $(\n            selectorFormContainer + ' .formControls #form-buttons-continue',\n          ).trigger('click', { select: ev.target, from_marine_widget: true });\n        });\n\n        $(selectElement).on('select2-close', function () {\n          $(marineUnitTriggerSelector).css('background', 'transparent');\n          $(marineUnitTriggerSelector + ' a').css('background', 'transparent');\n          $(marineUnitTriggerSelector + ' .arrow').show();\n        });\n\n        /// Marine Unit id selector\n        if (\n          $(selectorLeftForm + ' select').hasClass('js-example-basic-single')\n        ) {\n          // Select2 has been initialized\n          var text = $(\n            selectorLeftForm +\n              ' select [value=\"' +\n              jQuery(selectorLeftForm + ' .select-article select').val() +\n              '\"]',\n          ).text();\n          $(selectorLeftForm + ' select:not(.notselect)')\n            .parentsUntil('.field')\n            .before(\n              '<div id=\"marine-unit-trigger\">' +\n                '<div class=\"text-trigger\">' +\n                text +\n                '</div>' +\n                '</div>',\n            );\n\n          $(marineUnitTriggerSelector).on('click', function () {\n            if (loading) return false;\n            $(marineUnitTriggerSelector).css(\n              'background',\n              'rgb(238, 238, 238)',\n            );\n            $(marineUnitTriggerSelector + ' a').css(\n              'background',\n              'rgb(238, 238, 238)',\n            );\n\n            $(selectorLeftForm + ' select:not(.notselect)').select2('open');\n\n            var trH = $(marineUnitTriggerSelector + ' a').height();\n            $('.select2-top-override-dropdown').css(\n              'margin-top',\n              trH / 2 + 'px',\n            );\n          });\n        }\n      });\n  }\n\n  function attachSelect2() {\n    setupRightSelects2();\n    setupLeftSelect2();\n    marineUnitSelect();\n\n    var w = 'auto';\n    var daw = true;\n    if (window.matchMedia('(max-width: 967px)').matches) {\n      w = false;\n      daw = false;\n    }\n\n    var options = {\n      placeholder: 'Select an option',\n      closeOnSelect: true,\n      dropdownAutoWidth: daw,\n      width: w,\n      theme: 'flat',\n      minimumResultsForSearch: 20,\n      containerCssClass: 'extra-details-select',\n    };\n\n    $.each(\n      $(selectorLeftForm + ' .extra-details-select'),\n      function (idx, elem) {\n        if ($(elem).find('option').length > 1) {\n          $(elem).select2(options);\n        } else {\n          $(elem).hide();\n        }\n      },\n    );\n\n    $(selectorLeftForm + ' .extra-details .tab-panel').fadeOut(\n      'slow',\n      function () {\n        $.each(\n          $(selectorLeftForm + ' .extra-details .extra-details-section'),\n          function (indx, item) {\n            $($(item).find('.tab-panel')[0]).show();\n          },\n        );\n      },\n    );\n\n    $(selectorLeftForm + ' .extra-details-select').on(\n      'select2-selecting',\n      function (ev) {\n        var sect = $(ev.target).parentsUntil('.extra-details-section').parent();\n        $.each($(sect).find('.tab-panel'), function (idx, elem) {\n          if ($(elem).attr('id') !== ev.choice.id) {\n            $(elem).hide();\n          } else {\n            $(elem).fadeIn();\n          }\n        });\n      },\n    );\n\n    if ($(selectorLeftForm + ' .tab-content .tab-pane.fade').length > 0) {\n      $(\n        $(\n          selectorLeftForm +\n            ' .tab-content.msfd-extra-tab-content .tab-pane.fade',\n        )[0],\n      ).addClass('in active');\n      $(\n        $(selectorLeftForm + ' .nav-tabs.msfd-extra-nav-tabs .nav-item')[0],\n      ).addClass('active');\n    }\n  }\n  /*\n   * SELECT2 functions END\n   * */\n\n  function marineBtnHandler(ev) {\n    var direction = ev.data.direction;\n    var marinUidSelect = $(\n      selectorFormContainer + ' #s2id_form-widgets-marine_unit_id',\n    );\n    var selectedV = marinUidSelect.select2('data');\n\n    var nextEl = $(selectedV.element[0]).next();\n    var prevEl = $(selectedV.element[0]).prev();\n\n    if (direction === 'next') {\n      var dir = nextEl.val();\n    } else if (direction === 'prev') {\n      var dir = prevEl.val();\n    }\n\n    // reset paging\n    $(selectorFormContainer + \" [name='form.widgets.page']\").remove();\n\n    $(selectorFormContainer + ' #form-widgets-marine_unit_id')\n      .select2()\n      .val(dir)\n      .trigger('change', { from_marine_widget: true });\n    $(selectorFormContainer + ' #s2id_form-widgets-marine_unit_id').hide();\n\n    //$(selectorFormContainer + \" .formControls #form-buttons-continue\").trigger(\"click\");\n    $(selectorFormContainer + ' .formControls #form-buttons-continue').trigger(\n      'click',\n    );\n  }\n\n  function setPaginationButtons() {\n    var prevButton = $(\".msfd-search-wrapper [name='form.buttons.prev']\");\n    var nextButton = $(\".msfd-search-wrapper [name='form.buttons.next']\");\n    var continueBtn = '.formControls #form-buttons-continue';\n\n    prevButton.one('click', function () {\n      if (loading) return false;\n      $(selectorFormContainer)\n        .find('form')\n        .append(\"<input type='hidden' name='form.buttons.prev' value='Prev'>\");\n      $(selectorFormContainer).find(continueBtn).trigger('click');\n    });\n\n    nextButton.one('click', function () {\n      if (loading) return false;\n      $(selectorFormContainer)\n        .find('form')\n        .append(\"<input type='hidden' name='form.buttons.next' value='Next'>\");\n      $(selectorFormContainer).find(continueBtn).trigger('click');\n    });\n\n    var selected = $(selectorLeftForm + ' select:not(.notselect)').val();\n\n    var opts = $(selectorLeftForm + ' select:not(.notselect) option');\n    var formBtnPrevTop = '#form-buttons-prev-top';\n    var formBtnNextTop = '#form-buttons-next-top';\n    var marineUnitTrigger = '#marine-unit-trigger';\n\n    $('#marine-unit-nav').hide();\n    // ignore 1st option for \"prev\" button\n    if (\n      $(selectorLeftForm + ' select:not(.notselect)').val() !== $(opts[1]).val()\n    ) {\n      var topPrevBtn =\n        '<button type=\"submit\" id=\"form-buttons-prev-top\" name=\"marine.buttons.prev\"' +\n        ' class=\"submit-widget button-field btn btn-default pagination-prev\" value=\"\" button=\"\">' +\n        '          </button>';\n\n      $(formBtnPrevTop).append(topPrevBtn);\n\n      $(formBtnPrevTop).on(\n        'click',\n        null,\n        { direction: 'prev' },\n        marineBtnHandler,\n      );\n      $(formBtnPrevTop).hide();\n      $(marineUnitTrigger + ' .arrow-left-container').one('click', function () {\n        $(formBtnPrevTop).trigger('click');\n      });\n    } else {\n      $(marineUnitTrigger + ' .arrow-left-container').hide();\n      $('.text-trigger').css('margin-left', 0);\n    }\n\n    // ignore last option for \"next\" button\n    if (\n      $(selectorLeftForm + ' select:not(.notselect)').val() !==\n      $(opts[opts.length - 1]).val()\n    ) {\n      var topNextBtn =\n        '<button type=\"submit\" id=\"form-buttons-next-top\" name=\"marine.buttons.next\"' +\n        'class=\"submit-widget button-field btn btn-default pagination-next\" value=\"\">' +\n        '</button>';\n\n      $(formBtnNextTop).append(topNextBtn);\n\n      $(formBtnNextTop).on(\n        'click',\n        null,\n        { direction: 'next' },\n        marineBtnHandler,\n      );\n      $(formBtnNextTop).hide();\n      $(marineUnitTrigger + ' .arrow-right-container').one(\n        'click',\n        function () {\n          $('#form-buttons-next-top').trigger('click');\n        },\n      );\n    } else {\n      $(marineUnitTrigger + ' .arrow-right-container').hide();\n    }\n  }\n\n  var paginationTextResult = '.pagination-text > span:first-child';\n\n  function initPaginationInput() {\n    // check if results more than 2, if not then disable\n    if (parseInt($($('.pagination-text > span:nth-child(2)')[0]).text()) < 3) {\n      return false;\n    }\n\n    $(paginationTextResult).addClass('pagination-result');\n\n    if ($(paginationTextResult).parent().find('input').length === 0) {\n      $(paginationTextResult).after(\n        '<input type=\"text\" class=\"pagination-input\" />',\n      );\n      $('.pagination-text .pagination-input').hide();\n\n      paginationInputHandlers();\n    }\n\n    $('.msfd-search-wrapper').on('click', paginationTextResult, function (ev) {\n      $(ev.target)\n        .parent()\n        .find('input')\n        .show(300)\n        .focus()\n        .css('display', 'inline-block');\n      $(ev.target).hide();\n    });\n\n    $('.msfd-search-wrapper').on('click', function (ev) {\n      // if click is on the result text\n      if (\n        $(ev.target).is(paginationTextResult) ||\n        $(ev.target).is('.pagination-text .pagination-input')\n      ) {\n      } else {\n        $(paginationTextResult).parent().find('input').hide();\n        $(paginationTextResult).show();\n      }\n    });\n  }\n\n  function paginationInputHandlers() {\n    var inp = $('.pagination-text .pagination-input');\n\n    // pagination input delay auto-submit\n    inp.bind('focusout', function (e) {\n      var val = $(e.target).val();\n      var maximum = parseInt($($(e.target).parent().find('> span')[1]).text());\n\n      if (loading) {\n        return false;\n      }\n\n      var _this = $(this);\n      var validateNr = function (x, maximum) {\n        if (isNaN(parseInt(x))) {\n          return false;\n        } else {\n          x = parseInt(x);\n          var res = $($(paginationTextResult)[0]).text();\n          if (x === parseInt(res)) {\n            return false;\n          }\n          if (x > maximum) {\n            return maximum - 1;\n          }\n          if (x <= 0) {\n            return false;\n          }\n        }\n        return x === 1 ? 0 : x - 1;\n      };\n      var validator = validateNr(val, maximum);\n      if (validator !== false) {\n        $(selectorFormContainer + \" [name='form.widgets.page']\").val(validator);\n        $(paginationTextResult).text(val);\n        $(paginationTextResult).show();\n        $(paginationTextResult).parent().find('input').hide();\n        $(\n          selectorFormContainer + ' .formControls #form-buttons-continue',\n        ).trigger('click');\n      } else {\n        $(e.target).val('');\n        $(paginationTextResult).parent().find('input').hide();\n        $(paginationTextResult).show();\n      }\n    });\n  }\n\n  function initPageElems() {\n    // move marine unit id below form title and pagination as seen on the\n    // other article tabs\n    $('.form-check').addClass('option');\n    $('.form-label').addClass('horizontal');\n    var pagination = $('.prev-next-row').eq(0);\n    if (pagination.length) {\n      $('#marine-widget-top').detach().insertBefore(pagination);\n    }\n\n    initStyling();\n\n    var $fields = $(selectorFormContainer + ', ' + selectorLeftForm).find(\n      '[data-fieldname]',\n    );\n\n    $(selectorFormContainer + ',' + selectorLeftForm).animate(\n      { opacity: 1 },\n      1000,\n    );\n\n    if ($fields.length > 0) {\n      generateCheckboxes($fields, $fields.length);\n    }\n\n    var $heading = $('.msfd-heading');\n    var $startLink = $('.msfd-start-link');\n    if ($heading.length && $startLink.length) {\n      $heading.insertAfter($startLink);\n    }\n\n    addCheckboxHandlers($(selectorFormContainer));\n    addCheckboxLabelHandlers();\n    attachSelect2();\n\n    if ('undefined' !== typeof window.setupTabs && null !== window.setupTabs)\n      window.setupTabs();\n\n    if ('undefined' !== typeof clickFirstTab && null !== clickFirstTab)\n      clickFirstTab();\n\n    setPaginationButtons();\n    initPaginationInput();\n    getAppliedFilters();\n  }\n\n  /*\n   * Form handlers\n   * */\n  function beforeSendForm(jqXHR, settings) {\n    window.WISE.blocks = [];\n    $(selectorLeftForm + ' .no-results').remove();\n\n    $('#form-widgets-marine_unit_id').prop('disabled', true);\n    $(\"[name='form.buttons.prev'], [name='form.buttons.next']\").prop(\n      'disabled',\n      true,\n    );\n    $(\"[name='marine.buttons.prev'], [name='marine.buttons.next']\").prop(\n      'disabled',\n      true,\n    );\n\n    var cont =\n      $('#marine-widget-top').length > 0\n        ? $('#marine-widget-top').next()\n        : $('.left-side-form');\n    cont.css('position', 'relative');\n\n    cont.prepend(\"<div id='wise-search-form-preloader'/>\");\n    $('#wise-search-form-preloader').append(\n      \"<span style='position: absolute; display: block; left: 50%; top: 50%;'></span>\",\n    );\n    $('#wise-search-form-preloader > span').append(\n      $('#ajax-spinner2').clone().attr('id', 'ajax-spinner-center').show(),\n    );\n\n    $('#ajax-spinner-center').css({ position: 'fixed' });\n    $('#wise-search-form-top').find('.alert').remove();\n\n    loading = true;\n  }\n\n  function formSuccess(data, status, req) {\n    $(selectorLeftForm + ' #wise-search-form-top')\n      .siblings()\n      .html('');\n    $(selectorLeftForm + ' #wise-search-form-top')\n      .siblings()\n      .fadeOut('fast');\n\n    $(selectorLeftForm + ' .topnav')\n      .next()\n      .remove();\n\n    var $data = $(data);\n\n    window.WISE.formData = $(data).find(selectorFormContainer).clone(true);\n\n    var chtml = $data.find(selectorFormContainer);\n\n    var fhtml = chtml.html();\n\n    console.log('success');\n    $('#wise-search-form-preloader').remove();\n\n    var centerContentD = $data\n      .find(selectorLeftForm + ' #wise-search-form-top')\n      .siblings();\n\n    $(selectorFormContainer).html(fhtml);\n\n    if ($data.find(selectorLeftForm + ' .topnav').next().length > 0) {\n      $(selectorLeftForm + ' .topnav').after(\n        $data.find(selectorLeftForm + ' .topnav').next(),\n      );\n    }\n\n    $(selectorLeftForm + ' #wise-search-form-top')\n      .siblings()\n      .remove();\n    $(selectorLeftForm + ' #wise-search-form-top').after(centerContentD);\n\n    initPageElems();\n\n    getAppliedFilters();\n    var formAction = $('.wise-search-form-container form').attr('action') || '';\n    if (formAction.includes('/marine/++api++')) {\n      var newFormAction = formAction;\n    } else {\n      var newFormAction = formAction.replace('/marine/', '/marine/++api++/');\n    }\n    if (formAction.includes('localhost') && !formAction.includes('++api++')) {\n      newFormAction = newFormAction.replace('http://localhost:3000/', 'http://localhost:3000/++api++/');\n    }\n\n\n    $('.wise-search-form-container form').attr('action', newFormAction);\n    removeNoValues();\n\n    setTimeout(function () {\n      fixTableHeaderAndCellsHeight();\n    }, 300);\n\n    // addDoubleScroll();\n\n    $(\"[name='form.buttons.prev']\").prop('disabled', false);\n    $(\"[name='form.buttons.next']\").prop('disabled', false);\n\n    $(\"[name='marine.buttons.prev']\").prop('disabled', false);\n    $(\"[name='marine.buttons.next']\").prop('disabled', false);\n    $('#wise-search-form-top').find('.alert').remove();\n  }\n\n  /* - table_sorter.js - */\n  /********* Table sorter script *************/\n  /*\n   * For all table elements with 'listing' class,\n   * when user clicks on a th without 'nosort' class,\n   * it sort table values using the td class with 'sortabledata-mydata' name,\n   * or the td text content\n   *\n   */\n  function sortabledataclass(cell) {\n    var re, matches;\n\n    re = new RegExp('sortabledata-([^ ]*)', 'g');\n    matches = re.exec(cell.attr('class'));\n    if (matches) {\n      return matches[1];\n    } else {\n      return null;\n    }\n  }\n\n  function sortable(cell) {\n    // convert a cell a to something sortable\n\n    // use sortabledata-xxx cell class if it is defined\n    var text = sortabledataclass(cell);\n    if (text === null) {\n      text = cell.text();\n    }\n\n    // A number, but not a date?\n    if (\n      text.charAt(4) !== '-' &&\n      text.charAt(7) !== '-' &&\n      !isNaN(parseFloat(text))\n    ) {\n      return parseFloat(text);\n    }\n    return text.toLowerCase();\n  }\n\n  function sort() {\n    var th, colnum, table, tbody, reverse, index, data, usenumbers, tsorted;\n\n    th = $(this).closest('th');\n    colnum = $('th', $(this).closest('thead')).index(th);\n    table = $(this).parents('table:first');\n    tbody = table.find('tbody:first');\n    tsorted = parseInt(table.attr('sorted') || '-1', 10);\n    reverse = tsorted === colnum;\n\n    $(this).parent().find('th:not(.nosort) .sortdirection').html('&#x2003;');\n    $(this)\n      .children('.sortdirection')\n      .html(reverse ? '&#x25b2;' : '&#x25bc;');\n\n    (index = $(this).parent().children('th').index(this)),\n      (data = []),\n      (usenumbers = true);\n    tbody.find('tr').each(function () {\n      var cells, sortableitem;\n\n      cells = $(this).children('td');\n      sortableitem = sortable(cells.slice(index, index + 1));\n      if (isNaN(sortableitem)) {\n        usenumbers = false;\n      }\n      data.push([\n        sortableitem,\n        // crude way to sort by surname and name after first choice\n        sortable(cells.slice(1, 2)),\n        sortable(cells.slice(0, 1)),\n        this,\n      ]);\n    });\n\n    if (data.length) {\n      if (usenumbers) {\n        data.sort(function (a, b) {\n          return a[0] - b[0];\n        });\n      } else {\n        data.sort();\n      }\n      if (reverse) {\n        data.reverse();\n      }\n      table.attr('sorted', reverse ? '' : colnum);\n\n      // appending the tr nodes in sorted order will remove them from their old ordering\n      tbody.append(\n        $.map(data, function (a) {\n          return a[3];\n        }),\n      );\n      // jquery :odd and :even are 0 based\n      tbody.each(setoddeven);\n    }\n  }\n\n  function setoddeven() {\n    var tbody = $(this);\n    // jquery :odd and :even are 0 based\n    tbody\n      .find('tr')\n      .removeClass('odd')\n      .removeClass('even')\n      .filter(':odd')\n      .addClass('even')\n      .end()\n      .filter(':even')\n      .addClass('odd');\n  }\n\n  function formAjaxComplete(jqXHR, textStatus) {\n    if (textStatus === 'success') {\n      $(selectorFormContainer).fadeIn('fast', function () {\n        $(selectorLeftForm + ' #wise-search-form-top')\n          .siblings()\n          .fadeIn('fast', function () {\n            setTimeout(function () {\n              fixTableHeaderAndCellsHeight();\n            }, 50);\n          });\n      });\n    }\n\n    $(selectorLeftForm + ' #loader-placeholder').remove();\n\n    $('#form-widgets-marine_unit_id').prop('disabled', false);\n\n    if ($(selectorLeftForm + ' select').hasClass('js-example-basic-single')) {\n      // Select2 has been initialized\n      if (\n        $(selectorLeftForm + ' .select2-choice').width() / 2 <=\n        $(selectorLeftForm + ' #select2-chosen-3').width()\n      ) {\n        $(selectorLeftForm + ' .select2-choice').css('width', '50%');\n      } else if (\n        2 * ($(selectorLeftForm + ' .select2-choice').width() / 3) <=\n        $(selectorLeftForm + ' #select2-chosen-3').width()\n      ) {\n        $(selectorLeftForm + ' .select2-choice').css('width', '70%');\n      }\n    }\n\n    if ($('#wise-search-form-top').next().length === 0) {\n      $(selectorLeftForm + ' #wise-search-form-top').after(\n        \"<span class='no-results'>No results found.</span>\",\n      );\n    }\n\n    loading = false;\n\n    // set up blank spaceholder gif\n    var blankarrow = $('<span>&#x2003;</span>').addClass('sortdirection');\n    // all listing tables not explicitly nosort, all sortable th cells\n    // give them a pointer cursor and  blank cell and click event handler\n    // the first one of the cells gets a up arrow instead.\n    $('table.listing:not(.nosort) thead th:not(.nosort)')\n      .append(blankarrow.clone())\n      .css('cursor', 'pointer')\n      .click(sort);\n    $('table.listing:not(.nosort) tbody').each(setoddeven);\n\n    if (typeof scanforlinks !== 'undefined') jQuery(scanforlinks);\n    setTimeout(function () {\n      fixTableHeaderAndCellsHeight();\n      fixDoubleScrollWidth();\n    }, 300);\n    addDoubleScroll();\n  }\n\n  function formAjaxError(req, status, error) {\n    $('#wise-search-form-top').find('.alert').remove();\n    $('#wise-search-form-top').append(\n      '<div class=\"alert alert-danger alert-dismissible show\" style=\"margin-top: 2rem;\" role=\"alert\">' +\n        '  <strong>There was a error from the server.</strong> You should check in on some of those fields from the form.' +\n        '  <button type=\"button\" class=\"ui button close\" data-dismiss=\"alert\" aria-label=\"Close\">' +\n        '    <span aria-hidden=\"true\">&times;</span>' +\n        '  </button>' +\n        '</div>',\n    );\n\n    $('#form-widgets-marine_unit_id').prop('disabled', false);\n\n    $('#wise-search-form-container-preloader').remove();\n    $('#wise-search-form-preloader').remove();\n\n    $('#ajax-spinner-form').hide();\n\n    $(\"[name='form.buttons.prev']\").prop('disabled', true);\n    $(\"[name='form.buttons.next']\").prop('disabled', true);\n\n    $(\"[name='marine.buttons.prev']\").prop('disabled', true);\n    $(\"[name='marine.buttons.next']\").prop('disabled', true);\n\n    if (typeof Storage !== 'undefined') {\n      sessionStore.removeItem('form');\n    }\n\n    loading = false;\n  }\n\n  function resetEmptyCheckboxes(fieldID) {\n    $.each($('#' + fieldID).find('.option'), function (idx, item) {\n      $(item).find(\"[type='checkbox']\").prop('checked', true);\n    });\n  }\n\n  function resetConfigsbelowFacet(\n    called_from,\n    called_from_button,\n    called_from_select,\n    args,\n  ) {\n    var empty_next_inputs;\n    var empty_sibling_input;\n    if (!called_from || called_from_button || called_from_select) {\n      empty_next_inputs = function (el) {\n        var panel_group, subform_parent, subform_children;\n        panel_group = $(el).closest('.panel-group');\n        subform_parent = panel_group.closest('.subform');\n        subform_children = subform_parent.find('.subform');\n\n        panel_group.nextAll('.panel-group').find('.panel').empty();\n        if (subform_children.length) {\n          if (subform_children.hasClass('subform')) {\n            subform_children.empty();\n          }\n          subform_children.find('.panel').empty();\n          subform_children.find('.subform').empty();\n        } else {\n          $(el).parent().parent().next().empty();\n        }\n      };\n\n      empty_sibling_input = function (el) {\n        var nextFieldID = $(el).parent().next().attr('id');\n\n        var panel_group, subform_parent, subform_children;\n        panel_group = $(el).closest('.panel-group');\n        subform_parent = panel_group.closest('.subform');\n        subform_children = $(el).parent().parent().next();\n\n        if (\n          called_from.from_marine_widget !== undefined ||\n          called_from.from_marine_widget === true\n        ) {\n          return true;\n        }\n\n        if (nextFieldID === 'formfield-form-widgets-member_states') {\n          resetEmptyCheckboxes(nextFieldID);\n        } else {\n          resetEmptyCheckboxes('memberstatesform');\n        }\n        panel_group.nextAll('.panel-group').find('.panel').empty();\n        if (subform_children.length) {\n          subform_children.find('.subform').empty();\n        }\n      };\n      if (called_from_button) {\n        empty_next_inputs(called_from_button);\n      } else if (called_from_select) {\n        empty_sibling_input(called_from_select);\n      } else {\n        $('.ui-autocomplete-input').each(function (idx, el) {\n          if (el.value) {\n            empty_next_inputs(el);\n            return false;\n          }\n        });\n      }\n    }\n  }\n\n  function storageFactory(storage) {\n    var inMemoryStorage = {};\n\n    var length = 0;\n\n    function isSupported() {\n      try {\n        var testKey = '__some_random_key_you_are_not_going_to_use__';\n        storage.setItem(testKey, testKey);\n        storage.removeItem(testKey);\n        return true;\n      } catch (e) {\n        return false;\n      }\n    }\n\n    function clear() {\n      if (isSupported()) {\n        storage.clear();\n      } else {\n        inMemoryStorage = {};\n      }\n    }\n\n    function getItem(name) {\n      if (isSupported()) {\n        return storage.getItem(name);\n      }\n      if (inMemoryStorage.hasOwnProperty(name)) {\n        return inMemoryStorage[name];\n      }\n      return null;\n    }\n\n    function key(index) {\n      if (isSupported()) {\n        return storage.key(index);\n      } else {\n        return Object.keys(inMemoryStorage)[index] || null;\n      }\n    }\n\n    function removeItem(name) {\n      if (isSupported()) {\n        storage.removeItem(name);\n      } else {\n        delete inMemoryStorage[name];\n      }\n    }\n\n    function setItem(name, value) {\n      if (isSupported()) {\n        storage.setItem(name, value);\n      } else {\n        inMemoryStorage[name] = String(value); // not everyone uses TypeScript\n      }\n    }\n    return {\n      getItem: getItem,\n      setItem: setItem,\n      removeItem: removeItem,\n      clear: clear,\n      key: key,\n      length: length,\n    };\n  }\n\n  function storeFormtoLocalStorage(options) {\n    //var form =  $( selectorFormContainer ).find(\"form\");\n\n    //var strContent = $.getMultipartData(\"#\" + form.attr(\"id\"));\n    var data = options.data || null;\n    var boundary = options.boundary || null;\n    var formData = options.formData || null;\n\n    if (typeof LZString !== 'undefined') {\n      var compressed = LZString.compressToEncodedURIComponent(data);\n      var formD = LZString.compress(JSON.stringify(formData));\n\n      if (typeof Storage !== 'undefined') {\n        // We have local storage support\n        sessionStore.setItem('form-' + defaultForm, compressed); // to save to local storage\n        sessionStore.setItem('boundary', boundary);\n        sessionStore.setItem(defaultForm, formD);\n        // TODO: url shortner\n        //window.location.hash = compressed;\n      }\n    }\n  }\n\n  function searchFormAjax(boundary, data, url, formData) {\n    if (!url.includes('/marine/++api++')) {\n      url = url.replace('/marine/', '/marine/++api++/');\n    }\n    if (url.includes('localhost')) {\n      url = url.replace('http://localhost:3000/', 'http://localhost:3000/++api++/');\n    }\n\n    $.ajax({\n      type: 'POST',\n      contentType: 'multipart/form-data; boundary=' + boundary,\n      cache: false,\n      data: data,\n      dataType: 'html',\n      url: url,\n      //processData:false,\n      beforeSend: beforeSendForm,\n      success: function (dataRes, status, req) {\n        /*function isnotchecked($field) {\n                    var arr = [];\n                    $.each( $field.find(\".option input[type='checkbox']:not(:checked)\") , function (ix, ch) {\n                        arr.push( $(ch).parent() );\n                    });\n                    if(arr.length > 0){\n                        return true;\n                    }\n                    return false;\n                }\n                var $fields = $( selectorFormContainer + \", \" + selectorLeftForm ).find(\"[data-fieldname]\");\n                var cheked = false;\n\n                $.each($fields,function (ix, $field) {\n                    if(!isnotchecked($field)){\n                        cheked = true;\n                    }\n                });\n\n                if(cheked){\n                    storeFormtoLocalStorage({ boundary: boundary,data: data, formData: formData});\n                }*/\n\n        storeFormtoLocalStorage({\n          boundary: boundary,\n          data: data,\n          formData: formData,\n        });\n\n        formSuccess(dataRes, status, req);\n      },\n      complete: formAjaxComplete,\n      error: formAjaxError,\n    });\n  }\n\n  var defaultForm =\n    window.location.pathname.substr(\n      window.location.pathname.indexOf('@@'),\n      window.location.pathname.length - 1,\n    ) || 'defaultForm';\n\n  function restoreFromSessionStorage() {\n    if (sessionStore.getItem('form-' + defaultForm) === null) {\n      return false;\n    }\n    if ('undefined' === typeof LZString) {\n      console.error('LZString not found');\n      return false;\n    }\n\n    try {\n      //var dec = LZString.decompressFromEncodedURIComponent(sessionStore.form);\n      var dec = LZString.decompressFromEncodedURIComponent(\n        sessionStore.getItem('form-' + defaultForm),\n      );\n\n      var form = $(selectorFormContainer).find('form');\n\n      var strContent = $.getMultipartData('#' + form.attr('id'));\n\n      var compareVals = function (fromStorage, fromForm) {\n        var notSame = false;\n\n        try {\n          var prelFromStorage = JSON.parse(fromStorage);\n\n          $.each(Object.keys(prelFromStorage), function (ix, item) {\n            var arr = prelFromStorage[item];\n\n            //TODO: issue on some pages especially on pagination\n            var res =\n              typeof fromForm[item] !== 'undefined'\n                ? fromForm[item].filter(function (el) {\n                    return arr.indexOf(el) === -1;\n                  })\n                : [];\n            if (res.length > 0) {\n              notSame = true;\n              return false;\n            }\n          });\n        } catch (e) {\n          return false;\n        }\n\n        if (!notSame) return false;\n\n        return true;\n      };\n\n      var defForm = sessionStore.getItem(defaultForm);\n\n      var getFormD = $.getMultipartData(\n        '#' + form.attr('id'),\n        sessionStore.getItem('boundary'),\n      );\n\n      if (compareVals(LZString.decompress(defForm), strContent[2])) {\n        var url = form.attr('action');\n        var boundary = sessionStore.getItem('boundary');\n        searchFormAjax(boundary, dec, url);\n\n        // TODO: url shortner\n        //window.location.hash = sessionStore.getItem(\"form-\" + defaultForm);\n      } else {\n        console.log('same data');\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  function resetStorageForPage(ev) {\n    var isLink = $(this).attr('href').indexOf('@@');\n    var href = $(this).attr('href');\n    if (isLink > 0) {\n      ev.preventDefault();\n      var ls = $(this)\n        .attr('href')\n        .substr(isLink, href.length - 1);\n      sessionStore.removeItem(ls);\n      sessionStore.removeItem('form');\n      window.location.href = href;\n    }\n  }\n\n  function removeNoValues() {\n    /* Remove 'No value' options from all select elements\n     */\n    var $select = $('.select-widget');\n    $select.find(\"option:contains('No value')\").each(function () {\n      $(this).remove();\n    });\n  }\n\n  $.fn.fixTableHeaderAndCellsHeight = function () {\n    // because the <th> are position: absolute, they don't get the height of\n    // the <td> cells, and the other way around.\n    var MIN_HEIGHT = 30;\n\n    this.each(function () {\n      $(this)\n        .find('tr')\n        .each(function () {\n          var $tr = $(this);\n          var $th = $tr.find('th');\n          var $tds = $tr.find('td');\n\n          if ($th.length) {\n            // calculate tallest among th and its td siblings\n            var cells_max_height = 0;\n            $tds.each(function () {\n              cells_max_height = Math.max(cells_max_height, $(this).height());\n            });\n\n            var height = Math.max($th.height(), cells_max_height, MIN_HEIGHT);\n\n            // set consistent height\n            $th.height(height);\n            $tds.height(height);\n          }\n        });\n    });\n  };\n\n  function fixTableHeaderAndCellsHeight() {\n    var $table = $('.table-report');\n    $table.fixTableHeaderAndCellsHeight();\n  }\n\n  function fixDoubleScrollWidth() {\n    // fix double scroll width\n    $('.cloned-scroll-top').each(function () {\n      var $clonedScrollTop = $(this);\n      var $table = $clonedScrollTop.parent().find('table');\n      var tableWidth = $table.outerWidth((includeMargin = true));\n\n      if (tableWidth == null || tableWidth <= $table.parent().width()) {\n        $clonedScrollTop.children().width(0);\n        return;\n      }\n      $clonedScrollTop.children().width(tableWidth);\n    });\n  }\n\n  function addDoubleScroll() {\n    var secondScroll =\n      '<div class=\"cloned-scroll-top\" style=\"overflow-x: auto;\">' +\n      '<div style=\"height: 1px;\"></div>' +\n      '</div>';\n\n    $('.double-scroll').each(function () {\n      var $doubleScroll = $(this);\n      var $table = $doubleScroll.find('table');\n      var tableWidth = $table.outerWidth((includeMargin = true));\n\n      $doubleScroll.parent().before(secondScroll);\n      var $clonedScrollTop = $doubleScroll\n        .parent()\n        .siblings('.cloned-scroll-top')\n        .first();\n\n      $clonedScrollTop.on('scroll', function () {\n        $doubleScroll.scrollLeft($clonedScrollTop.scrollLeft());\n      });\n\n      $doubleScroll.scroll(function () {\n        $clonedScrollTop.scrollLeft($doubleScroll.scrollLeft());\n      });\n\n      if (tableWidth == null || tableWidth <= $table.parent().width()) {\n        $clonedScrollTop.children().width(0);\n        return;\n      }\n\n      $clonedScrollTop.children().width(tableWidth);\n    });\n  }\n\n  jQuery(document).ready(function ($) {\n    window.setTimeout(function () {\n      initPageElems();\n    }, 100);\n\n    var formAction = $('.wise-search-form-container form').attr('action') || '';\n    if (formAction.includes('/marine/++api++')) {\n      var newFormAction = formAction;\n    } else {\n      var newFormAction = formAction.replace('/marine/', '/marine/++api++/');\n    }\n    if (formAction.includes('localhost') && !formAction.includes('++api++')) {\n      newFormAction = newFormAction.replace('http://localhost:3000/', 'http://localhost:3000/++api++/');\n    }\n\n\n    $('.wise-search-form-container form').attr('action', newFormAction);\n\n    /*$(window).on(\"resize\", function () {\n            if (window.matchMedia(\"(max-width: 1024px)\").matches) {\n                /!*var el = $(\"#form-buttons-next-top\");\n                el.css(\"float\",\"right\");\n                $(\"#form-buttons-prev-top\").after(el);*!/\n\n                /!*$(\"#marine-widget-top > div\").css(\"display\", \"block\");\n                $(\"#marine-widget-top .field\").css(\"display\", \"block\");*!/\n            }\n        });*/\n\n    var AJAX_MODE = true;\n\n    window.WISE = {};\n    window.WISE.formData = $(selectorFormContainer).clone(true);\n    window.WISE.blocks = [];\n\n    // ajax form submission\n    $(selectorFormContainer)\n      .unbind('click')\n      .on('click', '.formControls #form-buttons-continue', function (ev) {\n        if (!AJAX_MODE) {\n          return true;\n        }\n        ev.preventDefault();\n\n        // empty facets below given facet where we had an interaction\n        // this way we reset the configurations below the given facet\n        // with which we interacted with\n        var called_from = arguments[1];\n\n        // if it is from a subform (second row of filters) like Country,\n        // GES Component, Feature etc. then we do not reset the facets below\n        try {\n          debugger;\n          var isSubform = called_from.from_marine_widget || $(called_from.button).closest('.subforms-wrapper').length > 0;\n        } catch (e) {\n          var isSubform = true;\n        }\n        \n        var resetFacets = !isSubform;\n\n        if (resetFacets) {\n          // empty subforms-wrapper\n          $('.subforms-wrapper').empty();\n          // simulate a click on the first option of the subforms, to reset the\n          // facets below it\n          // var firstOption = $('.subforms-wrapper .form-check.option').first();\n          // var calledFrom = {button: firstOption[0]};\n          // var called_from_button = called_from && called_from['button'];\n          // var called_from_select = called_from && called_from['select'];\n\n          // resetConfigsbelowFacet(\n          //   called_from,\n          //   called_from_button,\n          //   called_from_select,\n          //   arguments,\n          // );\n        }\n\n        var form = $(selectorFormContainer).find('form');\n        var url = form.attr('action');\n\n        var strContent = $.getMultipartData('#' + form.attr('id'));\n\n        searchFormAjax(strContent[0], strContent[1], url, strContent[2]);\n      });\n\n    restoreFromSessionStorage();\n\n    $('.topnav a').on('click', resetStorageForPage);\n\n    removeNoValues();\n    setTimeout(function () {\n      fixTableHeaderAndCellsHeight();\n    }, 300);\n    addDoubleScroll();\n\n    $(window).on('resize', function () {\n      fixTableHeaderAndCellsHeight();\n    });\n  });\n})(window, document, jQuery);"],"names":["window","document","$","storage","inMemoryStorage","exceptVal","selectorFormContainer","selectorLeftForm","sessionStore","sessionStorage","getItem","name","isSupported","hasOwnProperty","setItem","value","String","removeItem","clear","key","index","Object","keys","length","testKey","e","randomString","chars","randomstring","i","rnum","Math","floor","random","substring","loading","getMultipartData","frmName","newBoundary","initBoundary","strBoundary","strMultipartBody","strCRLF","formData","attr","serializeArray","res","vals","each","indx","val","push","searchAutoComplete","evtarget","$field","data","cheks2","find","labels","parentsUntil","parent","inputs","no_results","addClass","removeClass","idx","el","checked","indexOf","id","show","toSearch","toLowerCase","replace","matcher","RegExp","ui","autocomplete","escapeRegex","temp","found","map","ind","item","text","tohide","test","filter","elem","toshow","prop","inx","removeAttr","getAppliedFilters","WISE","appliedFilters","$f","this","fieldName","trim","values","closest","get","trigger","addCheckboxPanel","$label","$content","next","$controls","nextAll","wrapAll","children","chekspan","slice","remove","prepend","spAll","append","$subforms","minLength","source","search","event","target","create","that","on","ev","hasClass","$form","first","sortCheckboxesByChecked","arr","foundArr","all","undefined","blocks","ix","ch","concat","generateCheckboxes","$fields","$fieldsnr","count","field","$section","$list","$icon","cheks","renderFilters","empty","applied","$group","forEach","checkboxId","$tag","preventDefault","$cb","is","fieldId","self","hide","setTimeout","button","$header","off","slideToggle","toggleClass","animate","opacity","checkboxHandlerAll","par","rest","filterInvalidCheckboxes","checkboxHandlerNone","checkboxHandlerInvert","unchecked","cbxs","addCheckboxLabelHandlers","allch","stopPropagation","$checkbox","checkboxV","chV","setupRightSelects2","selector","forbiddenIDs","selectorFormCont","selectElement","selectedElementID","lessOptions","$wise_search_form","options","placeholder","closeOnSelect","dropdownAutoWidth","width","theme","minimumResultsForSearch","Infinity","select2","select","formatArticle","article","element","subtitle","attachSelect2","marineUnitTriggerSelector","allowClear","dropdownParent","dropdownAdapter","containerCssClass","dropdownCssClass","debug","trh","offset","top","css","height","margin-top","from_marine_widget","jQuery","before","trH","$selectArticle","fn","formatSelection","formatResult","one","location","href","pathname","split","join","choice","w","daw","matchMedia","matches","fadeOut","sect","fadeIn","marineBtnHandler","dir","direction","selectedV","nextEl","prevEl","prev","paginationTextResult","initPaginationInput","parseInt","after","bind","maximum","validator","x","isNaN","validateNr","focus","initPageElems","continueBtn","formBtnPrevTop","marineUnitTrigger","pagination","eq","detach","insertBefore","ajaxSpinner","clone","$article13","$article13form","insertAfter","$heading","$startLink","setupTabs","clickFirstTab","prevButton","nextButton","opts","formBtnNextTop","beforeSendForm","jqXHR","settings","cont","position","sortable","cell","exec","charAt","parseFloat","sort","usenumbers","th","colnum","table","parents","tbody","reverse","html","cells","sortableitem","a","b","setoddeven","end","formAjaxComplete","textStatus","siblings","fixTableHeaderAndCellsHeight","blankarrow","click","scanforlinks","$clonedScrollTop","$table","tableWidth","outerWidth","includeMargin","addDoubleScroll","formAjaxError","req","status","error","Storage","searchFormAjax","boundary","url","includes","ajax","type","contentType","cache","dataType","beforeSend","success","dataRes","$data","centerContentD","LZString","compressed","compressToEncodedURIComponent","formD","compress","JSON","stringify","defaultForm","fhtml","console","log","newFormAction","formAction","removeNoValues","complete","substr","restoreFromSessionStorage","dec","decompressFromEncodedURIComponent","form","strContent","defForm","fromStorage","fromForm","notSame","prelFromStorage","parse","compareVals","decompress","resetStorageForPage","isLink","ls","$doubleScroll","scrollLeft","scroll","cells_max_height","$tr","$th","$tds","max","ready","unbind","called_from","arguments","isSubform"],"mappings":"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"}